"use strict";var dd,__slice=[].slice;dd=function(){var a;return a=arguments.length?__slice.call(arguments,0):[],console.log(a)},angular.module("angularTreeDiagramApp",["ngAnimate","firebase"]),function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}};a=function(){function a(a,c){var d,e;this.scope=a,this.firebase=c,this.removeNode=b(this.removeNode,this),this.editNode=b(this.editNode,this),this.addNode=b(this.addNode,this),d=new Firebase("https://blinding-fire-9153.firebaseio.com"),e=this.firebase(d).$asObject(),e.$bindTo(this.scope,"nodes"),this.scope.addNode=this.addNode,this.scope.editNode=this.addNode,this.scope.removeNode=this.addNode}return a.$inject=["$scope","$firebase"],a.prototype.addNode=function(a){return this.scope.nodes.$add(a)},a.prototype.editNode=function(a){return this.scope.nodes.$save(a)},a.prototype.removeNode=function(a){return this.scope.nodes.$remove(a)},a}(),angular.module("angularTreeDiagramApp").controller("MainCtrl",a)}.call(this),function(){angular.module("angularTreeDiagramApp").directive("treeDiagramDirective",function(){return{restrict:"A",templateUrl:"./views/tree.html",controller:"MainCtrl",transclude:!0,require:"treeDiagramDirective",link:function(a,b){return a.nodeWidth=200,a.nodeHeight=100,a.viewHeight=b.innerHeight,a.zoom=1,a.draggingNode=null,a.selectedElements=[],a.roots={},a.maxNodeDisplay=20,a.Math=Math,a.treeExpandAll=!1,a.showModal=!1,a.treeRootsElements=b[0].querySelector(".tree-roots-elements"),a.newNode=function(a){var b;return b={id:Math.random()+"-"+Math.random()+"-"+Math.random(),displayName:"noname",hasChildren:!1,parentId:null,childrenCount:0,childlessCount:0},a&&_.extend(b,a),b},a.addNewNode=function(){return a.showModal=!0,a.modalPath="./views/editForm.html",a.formNode=a.newNode(),null},a.editNode=function(){return a.showModal=!0,a.modalPath="./views/editForm.html",a.formNode=a.nodes[document.querySelector(".rect.selected").parentNode.parentNode.getAttribute("id")],null},a.acceptForm=function(){return a.showModal=!1,a.nodes[a.formNode.id]||a.formNode.parentId||(a.roots[a.formNode.id]=a.formNode),a.nodes[a.formNode.id]=a.formNode,delete a.formNode,null},a.cancelForm=function(){return a.formNode={},a.showModal=!1,null},a.treeNodeExpand=function(b,c){var d,e,f,g;if(!a.treeExpandAll)if(a.nodes[a.nodes[b].parentId]){f=a.nodes[a.nodes[b].parentId].children;for(d in f)e=f[d],a.nodes[d].toggle&&a.treeNodeCollapse(d)}else{g=a.roots;for(d in g)e=g[d],a.treeNodeCollapse(d)}return!c&&a.nodes[b].childrenCount>=a.maxNodeDisplay&&(a.nodes["compact"+b]={id:"compact"+b,displayName:a.nodes[b].childrenCount+" nodes hidden",compacted:!0,parentId:b}),a.nodes[b].toggle=!0,null},a.treeNodeCollapse=function(b){return a.nodes["compact"+b]&&delete a.nodes["compact"+b],a.nodes[b].toggle=!1,null},a.expandAll=function(){var b,c,d,e;if(a.treeExpandAll=!a.treeExpandAll,a.treeExpandAll){a.zoom=.5,a.treeRootsElements.moved.x=0,$(".tree-roots-elements").css({transform:"translate(0px,100px) scale("+a.zoom+")"}),d=a.nodes;for(b in d)c=d[b],a.nodes[b].hasChildren&&(a.nodes[b].toggle=!0)}else{a.zoom=1,a.treeRootsElements.moved.x=$("#groups").width()/2-230*_.size(a.treeRoots)/2,$(".tree-roots-elements").css({transform:"translate("+($("#groups").width()/2-230*_.size(a.treeRoots)/2)+"px,100px) scale("+a.zoom+")"}),e=a.nodes;for(b in e)c=e[b],a.nodes[b].hasChildren&&(a.nodes[b].toggle=!1)}return null},a.toogleNode=function(b,c){return a.nodes[c].toggle?a.treeNodeCollapse(c):a.treeNodeExpand(c),null},a.$on("NODE_DRAG_START",function(b,c){return a.treeNodeCollapse(c),$(".tree-drop-circle:not(.tree-drop-circle"+c+")").addClass("cshow"),$("#"+c+" .tree-drop-circle").removeClass("cshow"),a.treeNodeDragging=!0,a.draggingNode=c,null}),a.$on("NODE_DRAG_END",function(b,c){return $(".tree-drop-circle").removeClass("cshow"),a.treeNodeDragging=!1,a.newParent&&(a.nodes[a.newParent].children[c]={id:c},a.nodes[a.newParent].hasChildren=!0,a.nodes[c].parentId?delete a.nodes[a.nodes[c].parentId].children[c]:delete a.roots[c],a.nodes[c].parentId=a.newParent.id),a.draggingNode=null,null}),a.treeDropAreaMouseenter=function(b,c){return a.newParent=c,$(".tree-drop-circle"+c).addClass("h"),null},a.treeDropAreaMouseleave=function(b,c){return a.newParent=null,$(".tree-drop-circle"+c).removeClass("h"),null},a.$watch("nodes",function(b){var c,d;if(b)for(c in b)d=b[c],d&&d.hasOwnProperty("id")&&!d.parentId&&(a.roots[c]=d);return null}),null}}})}.call(this),function(){angular.module("angularTreeDiagramApp").directive("draggable",function(){return{restrict:"A",link:function(a,b){return a.inst=Draggable.create(b,{zIndexBoost:!1,onClick:function(a){var c,d,e,f;if(a.ctrlKey)b.toggleClass("selected");else{for(f=document.querySelectorAll(".tree-parent .rect"),d=0,e=f.length;e>d;d++)c=f[d],c.classList.remove("selected");b.addClass("selected")}return null},onDragStart:function(){return a.$emit("NODE_DRAG_START",a.element.id),b.closest(".tree-parent").addClass("dragging"),null},onDragEnd:function(){return a.$emit("NODE_DRAG_END",a.element.id),b.closest(".tree-parent").removeClass("dragging"),a.newParent||TweenLite.set(b,{x:0,y:0}),null}}),null}}})}.call(this),function(){angular.module("angularTreeDiagramApp").directive("pane",function(){return{restrict:"A",link:function(a,b){var c;return c=null!==/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel",a.inst=Draggable.create(b,{trigger:"#Tree-Diagram"}),document.querySelector("#Tree-Diagram").onmousewheel=function(c){var d;return c.preventDefault(),d=c.detail||c.wheelDelta,a.zoom+=d/1e3,a.zoom=Math.min(Math.max(a.zoom,.2),3),TweenLite.set(b,{scale:a.zoom})},a.$on("NODE_DRAG_START",function(){return a.inst[0].disable(),null}),a.$on("NODE_DRAG_END",function(){return a.inst[0].enable(),null}),null}}})}.call(this);